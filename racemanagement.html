<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>IJRL Race Management</title>
    <meta name=”description” content=”The official IJRL website.”>
    <link rel="icon" href="assets/logobg.png">
    <link rel="stylesheet" href="stylesheets/styles.css">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="header">
      <img src="assets/logo.png" alt="">
    </div> 
    
    <section class="control">
      <div>
        <h1 id="title">IJRL Race Control: Disconnected</h1>
        <input class="fill-width" type="text" id="hookCode" name="hookCode" placeholder="Webhook Code">
        <input class="fill-width" type="text" id="steamLink" name="steamLink" placeholder="Steam Profile Link">
        <input class="fill-width" type="text" id="discID" name="discID" placeholder="Discord ID (Developer Mode)">

        <button id="setHook" onclick="setHook()">Connect To Hook</button>
      
        <button onclick="openLobby()">Lobby Open</button>
        <button onclick="openLobbyReserves()">Open To Reserves</button>
        <button onclick="readyMsg()">Ready Up Message</button>
        <button onclick="restartMsg()">Restart Lobby</button>
        <button onclick="raceEnded()">Race Ended</button>
      </div>
    </section>
  </body>

  <script>
    var steamLink = ""
    var discordID = ""
    var maindriverID = ""
    var reservedriverID = ""
    var linkschannelID = ""
    var webhook = ""

    function setHook(){
      document.getElementById("title").innerHTML = "IJRL Race Control: Connected"
      var splitcode = (document.getElementById('hookCode').value).split('.')
      
      steamLink = document.getElementById('steamLink').value
      discordID = document.getElementById('discID').value
      maindriverID = splitcode[1]
      reservedriverID = splitcode[2]
      linkschannelID = splitcode[3]
      webhook = "https://discord.com/api/webhooks/".concat(splitcode[0])
    
      document.getElementById('hookCode').style.display = "none";
      document.getElementById('steamLink').style.display = "none";
      document.getElementById('discID').style.display = "none";
      document.getElementById('setHook').style.display = "none";
    }

    function openLobby(){
        var dict = {
            "color": 0x1791ba,
            "title":"The Lobby is Now Open!", 
            "description":"<@&{0}> you are now able to join and fill your respective seats.\n\n<@&{1}> please wait until you get an invite to join.\n\nMake sure to have <@{2}> added on steam so we can invite you to the lobby:\n{3}".format(maindriverID, reservedriverID, discordID, steamLink)
        };

        sendMessage(dict, "||<@&{0}> <@&{1}>||".format(maindriverID, reservedriverID))
    }

    function openLobbyReserves(){
        var dict = {
            "color": 0x1791ba,
            "title":"Reserve Spaces Available", 
            "description":"<@&{0}> there are spaces available. \n\nThese are on a first come first serve basis, so join through the lobby leader to get your seat!".format(reservedriverID)
        };
        sendMessage(dict,"||<@&{0}>||".format(reservedriverID))
    }

    function readyMsg(){
        var dict = {
            "color": 0x1791ba,
            "title":"Ready Up!", 
            "description":"<@&{0}> <@&{1}> ready up, its time to start racing!\n\nRemember when setting up your race strategy at the start of the race, please do not ready up instantly to allow all drivers to setup!".format(maindriverID, reservedriverID)
        };
        sendMessage(dict, "||<@&{0}> <@&{1}>||".format(maindriverID, reservedriverID))
    }

    function restartMsg(){
        var dict = {
            "color": 0x1791ba,
            "title":"TECHNICAL ISSUES! - LOBBY RESTART", 
            "description":"<@&{0}> <@&{1}> due to technical issues we are going to have to restart the lobby. Please leave the session and join the new lobby.\n\nIf qualifying has already been completed, then top 10 must choose the tire they set their fastest lap on otherwise you will be disqualified. Everyone else has free choice.\n\nRemember when setting up your race strategy at the start of the race, please do not ready up instantly to allow all drivers to setup!\n\nThank you for your patience.".format(maindriverID, reservedriverID)
        };
        sendMessage(dict, "||<@&{0}> <@&{1}>||".format(maindriverID, reservedriverID))
    }

    function raceEnded(){
        var dict = {
            "color": 0x1791ba,
            "title":"GGs Everyone!", 
            "description":"<@&{0}> <@&{1}> congrats to the top 3 and we hope it was a great race!\n\nPlease make sure to report any incidents using the form in <#{2}>!\n\nYou can also share any of your best moments in <#757359006644699236> for all to see!".format(maindriverID, reservedriverID, linkschannelID)
        };
        sendMessage(dict, "||<@&{0}> <@&{1}>||".format(maindriverID, reservedriverID))
    }

    function sendMessage(embedDict, tagMessage) {
      var request = new XMLHttpRequest();
      request.open("POST", webhook);

      request.setRequestHeader('Content-type', 'application/json');

      var params = {
        username: "IJRL",
        content: tagMessage, 
        embeds: [embedDict]     
      }

      request.send(JSON.stringify(params));    
    }

    String.prototype.format = function() {
      var formatted = this;
      for( var arg in arguments ) {
          formatted = formatted.replace("{" + arg + "}", arguments[arg]);
      }
      return formatted;
    };

  </script>
  <style>
    .control{
      display: flex;
      justify-content: center;
      align-items: center; 
      margin: 0;
      max-width: none;
      height: 100%;
      padding: 10%;
      background-color: #1791ba;
    }

    .control h1{
      font-size: 20px;
      text-align: center;
      padding-bottom: 5%;
    }

    .control button{
      margin: auto;
      display:block;
      border-radius: 100px;
      color: white;
      background-color: #7289da;
      font-size: 25px;
      padding: 10px;
      padding-inline: 50px;
      border: none;
      margin-top: 10px;
      width: 100%;
    }

    .control input{
      border-radius: 5px;
      color: grey;
      font-size: 10px;
      padding: 10px;
      border: none;
      width: 100%;
      margin-bottom: 2%;
    }
    </style>
</html>